<!DOCTYPE html>
<html>
<head>
  <title>Interaktive Platzwahl (automatische Sperre)</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    img { max-width: 100%; height: auto; }
    area[disabled] {
      pointer-events: none;
      opacity: 0.3;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h2>Platzwahl</h2>
  <p>Plätze sind nur einmal wählbar – also entscheide dich gut!</p>
  <img src="lageplan.png" usemap="#platzwahl" id="lageplan">
  <map name="platzwahl" id="sitzmap">
    <!-- Dynamisch eingefügte Plätze -->
  </map>
  <p id="status">Lade belegte Plätze …</p>

  <script>
    const coords = {
      "A1": [17,15],
      "A2": [30,15],
      "A3": [41,14],
      "A4": [56,14],
      "A5": [95,15],
      "A6": [109,13],
      "A7": [122,13],
      "A8": [137,13],
      "A9": [149,15],
      "A10": [159,14],
      "A11": [172,12],
      "A12": [183,14],
      "A13": [212,13],
      "A14": [222,14],
      "A15": [238,12],
      "A16": [249,13],
      "A17": [264,14],
      "A18": [276,13],
      "A19": [284,13],
      "A20": [296,13],
      "B1": [16,43],
      "B2": [29,42],
      "B3": [40,41],
      "B4": [54,41],
      "B5": [96,41],
      "B6": [109,39],
      "B7": [121,39],
      "B8": [133,39],
      "B9": [147,39],
      "B10": [157,39],
      "B11": [173,41],
      "B12": [182,40],
      "B13": [210,39],
      "B14": [224,39],
      "B15": [235,39],
      "B16": [247,40],
      "B17": [263,39],
      "B18": [274,39],
      "B19": [288,40],
      "B20": [299,39],
      "C1": [17,65],
      "C2": [30,65],
      "C3": [41,65],
      "C4": [51,65],
      "C5": [96,64],
      "C6": [110,63],
      "C7": [121,64],
      "C8": [136,63],
      "C9": [146,63],
      "C10": [156,63],
      "C11": [169,63],
      "C12": [182,64],
      "C13": [214,63],
      "C14": [224,63],
      "C15": [238,64],
      "C16": [247,64],
      "C17": [260,63],
      "C18": [275,65],
      "C19": [287,62],
      "C20": [300,63],
      "D1": [16,91],
      "D2": [30,91],
      "D3": [41,91],
      "D4": [55,89],
      "D5": [93,89],
      "D6": [109,90],
      "D7": [122,90],
      "D8": [135,91],
      "D9": [145,90],
      "D10": [160,92],
      "D11": [172,88],
      "D12": [185,91],
      "D13": [211,91],
      "D14": [225,89],
      "D15": [235,89],
      "D16": [250,90],
      "D17": [261,90],
      "D18": [275,90],
      "D19": [285,90],
      "D20": [297,90],
      "E1": [17,114],
      "E2": [29,114],
      "E3": [42,113],
      "E4": [55,114],
      "E5": [95,114],
      "E6": [110,113],
      "E7": [123,114],
      "E8": [134,113],
      "E9": [147,112],
      "E10": [159,112],
      "E11": [173,112],
      "E12": [183,113],
      "E13": [208,111],
      "E14": [224,111],
      "E15": [236,112],
      "E16": [248,112],
      "E17": [263,112],
      "E18": [274,111],
      "E19": [287,111],
      "E20": [299,111],
      "F1": [17,140],
      "F2": [30,141],
      "F3": [42,140],
      "F4": [55,141],
      "F5": [97,140],
      "F6": [110,138],
      "F7": [121,137],
      "F8": [134,140],
      "F9": [147,140],
      "F10": [161,139],
      "F11": [171,138],
      "F12": [182,138],
      "F13": [208,138],
      "F14": [224,139],
      "F15": [236,138],
      "F16": [250,138],
      "F17": [264,138],
      "F18": [274,138],
      "F19": [287,138],
      "F20": [297,138],
      "G1": [16,165],
      "G2": [29,166],
      "G3": [45,167],
      "G4": [54,165],
      "G5": [94,162],
      "G6": [110,164],
      "G7": [121,163],
      "G8": [134,164],
      "G9": [149,165],
      "G10": [158,164],
      "G11": [170,162],
      "G12": [183,162],
      "G13": [210,163],
      "G14": [226,163],
      "G15": [249,162],
      "G16": [264,163],
      "G17": [274,163],
      "G18": [287,162],
      "G19": [305,162],
      "G20": [302,162],
      "H1": [17,192],
      "H2": [28,192],
      "H3": [41,193],
      "H4": [55,192],
      "H5": [96,191],
      "H6": [111,190],
      "H7": [121,190],
      "H8": [133,191],
      "H9": [147,190],
      "H10": [158,190],
      "H11": [173,190],
      "H12": [183,190],
      "H13": [213,192],
      "H14": [222,190],
      "H15": [238,190],
      "H16": [249,190],
      "H17": [265,192],
      "H18": [276,191],
      "H19": [289,191],
      "H20": [298,191],
      "I1": [19,219],
      "I2": [33,221],
      "I3": [47,222],
      "I4": [59,222],
      "I5": [95,219],
      "I6": [110,221],
      "I7": [121,218],
      "I8": [135,220],
      "I9": [146,221],
      "I10": [158,221],
      "I11": [172,220],
      "I12": [186,220],
      "I13": [211,220],
      "I14": [221,220],
      "I15": [235,219],
      "I16": [249,219],
      "I17": [263,222],
      "I18": [272,220],
      "I19": [287,220],
      "I20": [298,220],
      "J1": [19,248],
      "J2": [32,247],
      "J3": [44,248],
      "J4": [57,249],
      "J5": [94,246],
      "J6": [109,246],
      "J7": [121,248],
      "J8": [133,246],
      "J9": [149,247],
      "J10": [159,248],
      "J11": [169,248],
      "J12": [182,247],
      "J13": [209,247],
      "J14": [221,246],
      "J15": [236,246],
      "J16": [249,246],
      "J17": [258,246],
      "J18": [276,246],
      "J19": [285,246],
      "J20": [300,246],
      "K1": [97,272],
      "K2": [107,273],
      "K3": [121,274],
      "K4": [133,273],
      "K5": [147,272],
      "K6": [159,272],
      "K7": [171,273],
      "K8": [183,274],
      "K9": [209,271],
      "K10": [222,271],
      "K11": [237,273],
      "K12": [248,273],
      "K13": [260,272],
      "K14": [273,272],
      "K15": [288,271],
      "K16": [299,271],
      "L1": [96,298],
      "L2": [109,300],
      "L3": [121,299],
      "L4": [133,298],
      "L5": [145,300],
      "L6": [157,300],
      "L7": [170,299],
      "L8": [185,299],
      "L9": [209,300],
      "L10": [222,298],
      "L11": [235,298],
      "L12": [249,298],
      "L13": [264,299],
      "L14": [272,299],
      "L15": [285,299],
      "L16": [297,299],
      "M1": [99,323],
      "M2": [107,323],
      "M3": [121,324],
      "M4": [131,324],
      "M5": [147,324],
      "M6": [157,322],
      "M7": [169,322],
      "M8": [188,324],
      "M9": [207,322],
      "M10": [222,322],
      "M11": [237,322],
      "M12": [249,324],
      "M13": [261,324],
      "M14": [271,324],
      "M15": [287,323],
      "M16": [297,323],
      "N1": [96,351],
      "N2": [107,351],
      "N3": [121,351],
      "N4": [134,350],
      "N5": [147,349],
      "N6": [159,349],
      "N7": [175,349],
      "N8": [184,349],
      "N9": [210,348],
      "N10": [222,348],
      "N11": [235,348],
      "N12": [247,350],
      "N13": [260,351],
      "N14": [272,349],
      "N15": [286,348],
      "N16": [297,348],

    };

    const formBase = "https://docs.google.com/forms/d/e/1FAIpQLSfu-S2ZbrXsKnf60TermgBwNptGxLXNeCBMWdtgZsAAeNU7Hw/viewform?usp=pp_url&entry.838353268=";

    const sheetURL = "https://docs.google.com/spreadsheets/d/1e3mZuY5i76l5_eEpKmcxjzvEKiCWoeC04WXS_evXgJA/gviz/tq?tqx=out:json";

    async function fetchBelegtePlaetze() {
      try {
        const res = await fetch(sheetURL);
        const text = await res.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const belegte = new Set();

        json.table.rows.forEach(row => {
          const platz = row.c.find(c => c && c.v && /[A-N]\d{1,2}/i.test(c.v));
          if (platz) belegte.add(platz.v.trim().toUpperCase());
        });

        for (const [platz, [x, y]] of Object.entries(coords)) {
          const disabled = belegte.has(platz);
          const el = document.createElement("area");
          el.shape = "circle";
          el.coords = [x, y, 10].join(",");
          el.title = platz;
          el.alt = platz;
          if (!disabled) {
            el.href = formBase + platz;
          } else {
            el.setAttribute("disabled", "true");
          }
          document.getElementById("sitzmap").appendChild(el);
        }

        document.getElementById("status").innerText = "Belegte Plätze wurden geladen.";
      } catch (err) {
        document.getElementById("status").innerText = "Fehler beim Laden der belegten Plätze.";
        console.error(err);
      }
    }

    fetchBelegtePlaetze();
  </script>
</body>
</html>
